<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="js/dojo-release-1.9.3-src/dijit/themes/claro/claro.css"/>
    <script type="text/javascript">
        var dojoConfig = {
            async: true,
            parseOnLoad: true,
            packages: [
                {
                    name: "customWidget",
                    location: "../../customWidget"
                }
            ]
        };
    </script>
    <script type="text/javascript" src="js/dojo-release-1.9.3-src/dojo/dojo.js"></script>
    <script>
        require(["dojo/on","dojo/dom", "dijit/registry", "dojo/Deferred","dojo/_base/window","dojo/dom-construct",  "dojo/domReady!"
        ], function (on,dom, registry, Deferred,window,domConstruct) {
            function asyncProcess() {
                var timeout;
                var deferred = new Deferred(function (reason) {
                    //被取消时会执行
                    clearTimeout(timeout);
                    dom.byId("output").innerHTML += "<br/>I was cancelled with reason: " + reason;
                });
                //dom.byId("output").innerHTML += "<br/>I'm running...";
                timeout = setTimeout(function () {
                    //dom.byId("output").innerHTML += "<br/>My process completed!";
                    domConstruct.create("link", {
                        rel : "stylesheet",
                        type : "text/css",
                        href : "css/index.css"
                    }, window.doc.head||window.doc.getElementsByTagName("head")[0]);
                    deferred.resolve("finished");
                }, 2000);
                return deferred.promise;
            }
            on(dom.byId("startButton"), "click", function () {
                var process = asyncProcess();
                process.then(function (results) {
                    //dom.byId("output").innerHTML += "<br/>I'm finished, and the result was: " + results;
                });
                /*setTimeout(function () {
                    process.cancel("goodbye");
                }, 1000);*/
            });

        });
    </script>
</head>
<body class="claro">
<div id="output">Not yet started.</div>
<button type="button" id="startButton">Start</button>
</body>
</html>
